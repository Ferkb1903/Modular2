# Macro para simulaci√≥n heterog√©nea completa - HDR Brachytherapy
# Incluye hueso, aire, m√∫sculo, grasa y OARs (vejiga, recto)

# Configuraci√≥n inicial
/run/verbose 1
/event/verbose 0
/tracking/verbose 0

# Inicializar la geometr√≠a
/run/initialize

# Configurar generador de part√≠culas (espectro realista Ir-192)
/gun/particle gamma
/gun/energy 317 keV
/gun/position 0 0 0 mm
/gun/direction 0 0 1

# Configurar n√∫mero de threads para simulaci√≥n r√°pida
/run/numberOfThreads 4

# Configurar scoring para an√°lisis TG-43
/score/create/boxMesh boxMesh_het
/score/mesh/boxSize 15 15 15 cm
/score/mesh/nBin 30 30 30
/score/mesh/translate/xyz 0 0 0 cm
/score/quantity/energyDeposit eDep
/score/close

# SIMULACI√ìN PRINCIPAL - Heterogeneous phantom
echo "==================================================="
echo "HDR Brachytherapy - SIMULACI√ìN HETEROG√âNEA"
echo "==================================================="
echo "Geometr√≠a: Fantoma multicapa con heterogeneidades"
echo "  - Hueso cortical (costillas)"
echo "  - Cavidad a√©rea (pulm√≥n)"
echo "  - M√∫sculo esquel√©tico"
echo "  - Tejido adiposo"
echo "  - OARs: Vejiga y Recto"
echo ""
echo "Fuente: Ir-192 HDR (espectro completo)"
echo "Eventos: 10,000 (an√°lisis estad√≠stico robusto)"
echo "==================================================="

# Ejecutar simulaci√≥n
/run/beamOn 10000

# An√°lisis autom√°tico
echo ""
echo "‚úÖ Simulaci√≥n heterog√©nea completada"
echo "üìä Generando mapas de dosis..."

# Exportar scoring mesh
/score/dumpQuantityToFile boxMesh_het eDep heterogeneous_dose.txt

echo "üìÅ Archivos generados:"
echo "  - heterogeneous_dose.txt (mapa 3D de dosis)"
echo "  - Listo para an√°lisis con Python"
echo ""
echo "üîÑ Para an√°lisis: python3 ../scripts/simple_analysis.py"
