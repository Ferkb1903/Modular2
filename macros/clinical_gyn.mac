# Macro para simulaci√≥n cl√≠nica realista - Aplicador ginecol√≥gico
# Simula braquiterapia HDR de c√©rvix con aplicador ring+tandem

# Configuraci√≥n inicial
/run/verbose 1
/event/verbose 0

# Inicializar geometr√≠a cl√≠nica
/run/initialize

# Configurar fuente HDR realista
/gun/particle gamma
/gun/energy 380 keV  # Energ√≠a media Ir-192
/gun/position 0 0 0 mm

# Configurar aplicador ginecol√≥gico
echo "==================================================="
echo "SIMULACI√ìN CL√çNICA HDR - APLICADOR GINECOL√ìGICO"
echo "==================================================="
echo "Geometr√≠a:"
echo "  üè• Paciente anat√≥mico (pelvis femenina)"
echo "  üîß Aplicador ring + tandem"
echo "  üéØ Target: Tumor cervical"
echo "  ‚ö†Ô∏è  OARs: Vejiga, recto, intestino"
echo ""
echo "Protocolo cl√≠nico: 3 fracciones √ó 7 Gy"
echo "==================================================="

# Configurar scoring para DVH
/score/create/boxMesh clinical_mesh
/score/mesh/boxSize 20 20 15 cm
/score/mesh/nBin 40 40 30
/score/mesh/translate/xyz 0 0 0 cm
/score/quantity/energyDeposit eDep
/score/quantity/doseDeposit dose
/score/close

# Simular m√∫ltiples posiciones de source dwell
echo "üìç Simulando posiciones de tratamiento..."
echo "Posici√≥n 1: Tandem tip (+30mm)"
/gun/position 0 0 30 mm
/run/beamOn 3000

echo "Posici√≥n 2: Tandem medio (0mm)"
/gun/position 0 0 0 mm
/run/beamOn 3000

echo "Posici√≥n 3: Ring ovoid izquierdo (-15mm, +15mm)"
/gun/position -15 15 0 mm
/run/beamOn 2000

echo "Posici√≥n 4: Ring ovoid derecho (+15mm, +15mm)"
/gun/position 15 15 0 mm
/run/beamOn 2000

# Exportar datos para an√°lisis cl√≠nico
/score/dumpQuantityToFile clinical_mesh eDep clinical_dose_map.txt
/score/dumpQuantityToFile clinical_mesh dose clinical_dose_physical.txt

echo ""
echo "‚úÖ SIMULACI√ìN CL√çNICA COMPLETADA"
echo "üìä Datos exportados para an√°lisis DVH"
echo "üìÅ Archivos generados:"
echo "  - clinical_dose_map.txt"
echo "  - clinical_dose_physical.txt"
echo ""
echo "üè• An√°lisis recomendado:"
echo "  - DVH para PTV (Planning Target Volume)"
echo "  - Constrains para OARs"
echo "  - Optimizaci√≥n de tiempos de parada"
