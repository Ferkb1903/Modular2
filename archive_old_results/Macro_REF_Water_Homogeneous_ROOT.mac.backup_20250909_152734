# =================================================================
# MACRO DE REFERENCIA - PHANTOM HOMOGÉNEO (AGUA) - VERSIÓN ROOT
# =================================================================
# 
# CONFIGURACIÓN GEOMÉTRICA (basada en código fuente):
# - Phantom: 18×18×18 cm (radio = 9 cm en código)
# - World: 60×60×60 cm total  
# - Material: Solo agua (sin heterogeneidades)
# - Fuente: Iridio-192 FlexiSource en centro (0,0,0)
#
# CONFIGURACIÓN DE MALLA:
# - Cobertura: 18×18 cm (todo el phantom)
# - Resolución: 180×180 bins = 0.10 cm/bin = 1.0 mm
# - Espesor: 0.5 cm para excelente estadística
#
# Eventos: 10,000,000 para alta precisión estadística
# Threads: 14 para máximo rendimiento
# SALIDA: Archivos ROOT en lugar de ASCII
# =================================================================

# Configuración básica
/tracking/verbose 0
/run/verbose 1
/event/verbose 0

# Multithreading para máximo rendimiento
/run/numberOfThreads 14

# ¡IMPORTANTE! Deshabilitar heterogeneidades para phantom homogéneo
/phantom/enableHeterogeneities false

# Inicializar geometría y física
/run/initialize

# Configuración de fuente
/source/switch Flexi
/run/geometryModified

# Configuración del espectro de Iridio-192
/control/execute iridium_source_primary.mac

# ===== CONFIGURACIÓN DE MALLA DE SCORING =====
# Basada en geometría real del código fuente:
# - Phantom real: 18×18×18 cm
# - Malla: 18×18 cm para cubrir todo el phantom
# - Resolución: 180×180 = 0.10 cm/bin (1.0 mm de precisión)
# - Grosor Z: 0.5 cm para mejor estadística (40x mejora)

/score/create/boxMesh meshRef_Water_Homogeneous_ROOT
/score/mesh/boxSize 9.0 9.0 0.25 cm
/score/mesh/nBin 180 180 1
/score/mesh/translate/xyz 0. 0. 0. cm
/score/quantity/energyDeposit eDep
/score/close

# Verificar configuración
/score/list

# Progreso cada 100k eventos
/run/printProgress 100000

# Ejecutar 10 millones de eventos para alta precisión estadística
/run/beamOn 10000000

# =================================================================
# SALIDA EN FORMATO ROOT (NUEVA FUNCIONALIDAD)
# =================================================================
# El sistema BrachyUserScoreWriter automáticamente genera:
# 1. brachytherapy.root - Contiene histogramas 2D de la deposición
# 2. Mantiene compatibilidad con ASCII si se necesita

# OPCIONAL: También generar ASCII para compatibilidad
# ORIGINAL: # ORIGINAL: /score/dumpQuantityToFile meshRef_Water_Homogeneous eDep EnergyDeposition_REF_Water_Homogeneous10M.out
# ==> CONVERTIDO A ROOT OUTPUT:
/score/dumpQuantityToFile ORIGINAL: /score/dumpQuantityToFile meshRef_Water_Homogeneous
# ==> CONVERTIDO A ROOT OUTPUT:
/score/dumpQuantityToFile meshRef_Water_Homogeneous_ROOT eDep EnergyDeposition_REF_Water_Homogeneous10M.root

# Fin del macro
